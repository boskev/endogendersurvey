---
title:     "Endoscopy Gender Survey Resuls"
author:     "Kevin Williams"
requestor:    "Loren Rabinowitz"
date:       "June 12, 2021"
output: 
  html_document:
    theme: default

---

```{r SETUP-KNITR, setup, include=FALSE}
      knitr::opts_chunk$set(echo = TRUE)

```
  
<br>

## Introduction

This is a brief workflow highlighting the exploratory analysis of survey data mined to assist in the writing of the manuscript, ***"Gender Disparities Persist in Endoscopy Suite"*** **(Rabinowitz, et al.)**. Where appropriate, samples of the exact R syntax used will be displayed, along with the corresponding output (tabular data, graphical plots, maps, etc.).

<br>

***


#### Task 1:  Data Clean-Up

<br>


```{r FACTOR-PHASE-VARIABLE}


require(broom)
require(dplyr)

SURVEY  <-
    GENDER_DIFF_DATA_LABELS %>% 
    filter( COMPLETE != "Incomplete" &
            BIRTHSEX != "OTHER" &
            !is.na(BIRTHSEX) ) %>% 
   select( BIRTHSEX, RACE_SOUTHASIAN:RACE_OTHER, AGE, TRAINING_LEVEL) %>% 
  
    mutate(AGE2 = ifelse( AGE %in% c('< 30', '30-34', '35-40'), AGE, '> 40' )) %>% 
  
  
    mutate( RACE = ifelse( RACE_HISPANIC == "Y", "HISPANIC",
                   ifelse( RACE_WHITE == "Y", "WHITE",
                   ifelse( RACE_BLACK == "Y", "BLACK",
                   ifelse (RACE_SOUTHASIAN == "Y", "ASIAN SOUTH",
                   ifelse (RACE_EASTASIAN == "Y", "ASIAN EAST",
                   ifelse (RACE_NATIVEAMER == "Y", "OTHER",
                   ifelse (RACE_PACIFICISLAND == "Y", "OTHER",
                   ifelse (RACE_OTHER == "Y", "OTHER", "OTHER" )))))))))  %>% 
    mutate( BIRTHSEX = factor( BIRTHSEX,  levels= c("F","M") ))  %>% 
    mutate (AGE2 = factor(AGE2, levels = c('< 30', '30-34', '35-40', '> 40'))) %>%  
    mutate( RACE = factor(RACE, levels= c('ASIAN EAST', 'ASIAN SOUTH', 'BLACK', 'HISPANIC', 'WHITE', 'OTHER'))) %>% 
    mutate( TRAINING_LEVEL = factor (TRAINING_LEVEL, levels= c('First year fellow','Second year fellow', 'Third year fellow', 'Advanced fellow'))) %>% 
    mutate( TRAINING_LEVEL = recode_factor( TRAINING_LEVEL, 'First year fellow'= 'First Year', 
                                                            'Second year fellow'= 'Second Year', 
                                                            'Third year fellow' = 'Third Year', 
                                                            'Advanced fellow' = "Avanced", .ordered = T) )
            
            
```
  

<br>
  
#### Task 2:  Distribution by RACE x AGE

<br>

  
```{r CROSSTAB-GENDER-AGE }
  

#SJPlot cross tabulation with Chi-Square/df
  
plot_xtab(SURVEY$AGE2, SURVEY$BIRTHSEX, margin = "row", 
          bar.pos = "stack", coord.flip = TRUE, 
          axis.titles = c('Race Distribution by Birthsex'), 
          legend.title= "Sex",
          geom.colors = c("#006cc5","#cbcccb"), 
          show.summary = TRUE )+ 
  set_theme(base= theme_classic())

```

<br>

***

#### Task 3:  Distribution by RACE x BIRTHSEX

<br>

  
  
```{r CROSSTAB-GENDER-RACE }
  

#SJPlot cross tabulation with Chi-Square/df
  
plot_xtab(SURVEY$RACE, SURVEY$BIRTHSEX, margin = "row", 
          bar.pos = "stack", coord.flip = TRUE, 
          axis.titles = c('Race Distribution by Birthsex'), 
          legend.title= "Sex",
          geom.colors = c("#006cc5","#cbcccb"), 
          show.summary = TRUE )+ 
  set_theme(base= theme_classic())


```

<br>

***

#### Task 4:  Distribution by TRAINING LEVEL x BIRTHSEX

<br>

  
  
```{r CROSSTAB-GENDER-TRAINING }
  

#SJPlot cross tabulation with Chi-Square/df
  
plot_xtab(SURVEY$TRAINING_LEVEL, SURVEY$BIRTHSEX, margin = "row", 
          bar.pos = "stack", coord.flip = TRUE, 
          axis.titles = c('Race Distribution by Birthsex'), 
          legend.title= "Sex",
          geom.colors = c("#006cc5","#cbcccb"), 
          show.summary = TRUE )+ 
  set_theme(base= theme_classic())


```


***
